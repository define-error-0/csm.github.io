!function(t,e){if("function"==typeof define&&define.amd)define([],e);else if("undefined"!=typeof exports)e();else{e(),t.unknown={}}}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,(function(){function t(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,c=[],s=!0,u=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=i.call(n)).done)&&(c.push(r.value),c.length!==e);s=!0);}catch(t){u=!0,o=t}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return c}}(t,n)||e(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function o(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */o=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,n){return t[e]=n}}function f(t,e,n,r){var o=e&&e.prototype instanceof h?e:h,a=Object.create(o.prototype),c=new A(r||[]);return i(a,"_invoke",{value:x(t,n,c)}),a}function d(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=f;var p={};function h(){}function v(){}function y(){}var g={};l(g,c,(function(){return this}));var m=Object.getPrototypeOf,b=m&&m(m(O([])));b&&b!==e&&n.call(b,c)&&(g=b);var w=y.prototype=h.prototype=Object.create(g);function _(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function o(i,a,c,s){var u=d(t[i],t,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==r(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){o("next",t,c,s)}),(function(t){o("throw",t,c,s)})):e.resolve(f).then((function(t){l.value=t,c(l)}),(function(t){return o("throw",t,c,s)}))}s(u.arg)}var a;i(this,"_invoke",{value:function(t,n){function r(){return new e((function(e,r){o(t,n,e,r)}))}return a=a?a.then(r,r):r()}})}function x(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return L()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=S(a,n);if(c){if(c===p)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=d(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===p)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}function S(t,e){var n=e.method,r=t.iterator[n];if(void 0===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,S(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var o=d(r,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,p;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function R(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function O(t){if(t){var e=t[c];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:L}}function L(){return{value:void 0,done:!0}}return v.prototype=y,i(w,"constructor",{value:y,configurable:!0}),i(y,"constructor",{value:v,configurable:!0}),v.displayName=l(y,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,l(t,u,"GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},_(E.prototype),l(E.prototype,s,(function(){return this})),t.AsyncIterator=E,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new E(f(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(w),l(w,u,"Generator"),l(w,c,(function(){return this})),l(w,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(R),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),R(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;R(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:O(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},t}function i(t,e,n,r,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(r,o)}function a(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function c(t){i(a,r,o,c,s,"next",t)}function s(t){i(a,r,o,c,s,"throw",t)}c(void 0)}))}}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,(i=o.key,a=void 0,a=function(t,e){if("object"!==r(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,e||"default");if("object"!==r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(i,"string"),"symbol"===r(a)?a:String(a)),o)}var i,a}function u(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function l(){return l=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},l.apply(this,arguments)}var f,d,p,h=2592e6,v="api.YmlsaWJpbGk=.com";!function(t){t[t.NON_STRICT=0]="NON_STRICT",t[t.STRICT=1]="STRICT"}(f||(f={})),function(t){t.KEY="key",t.GROUP="group",t.APP="app"}(d||(d={})),function(t){t.PV="333.1334.kv-init.pv",t.ERROR="333.1334.kv-init.error"}(p||(p={}));var y=new(function(){function t(){c(this,t),this.queue=[],this.reporter=void 0,this.loading=!1}var n,i;return u(t,[{key:"loadScript",value:(i=a(o().mark((function t(e,n){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=document,t.abrupt("return",new Promise((function(t,o){var i,a=document.getElementById(e);a&&a.parentElement&&t(""),(a=r.createElement("script")).onload=function(){return t("")},a.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||t("")},a.onerror=function(){return o("load report script error")},a.id=e,a.type="text/JavaScript",a.src=n,null==(i=r.querySelector("head"))||i.appendChild(a)})));case 2:case"end":return t.stop()}}),t)}))),function(t,e){return i.apply(this,arguments)})},{key:"init",value:(n=a(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!this.reporter&&void 0!==("undefined"==typeof window?"undefined":r(window))){t.next=3;break}return t.abrupt("return");case 3:if(!this.loading){t.next=5;break}return t.abrupt("return");case 5:if(this.loading=!0,t.t0=window.ReporterPb,t.t0){t.next=10;break}return t.next=10,this.loadScript("kvReportDb","//s1.hdslb.com/bfs/seed/jinkela/short/reporter-pb/index.js");case 10:this.reporter=new window.ReporterPb({spmPrefix:"333.1334",sampleRate:1,autoPv:!1,feature:{tech:!0}}),this.loading=!1,this.reportQueue(),t.next=18;break;case 15:t.prev=15,t.t1=t.catch(0),this.loading=!1,console.error(t.t1);case 18:case"end":return t.stop()}}),t,this,[[0,15]])}))),function(){return n.apply(this,arguments)})},{key:"reportQueue",value:function(){if(this.reporter){var t,n=function(t,n){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=e(t))||n&&t&&"number"==typeof t.length){r&&(t=r);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return c=t.done,t},e:function(t){s=!0,a=t},f:function(){try{c||null==r.return||r.return()}finally{if(s)throw a}}}}(this.queue);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.report(r.event,r.value)}}catch(t){n.e(t)}finally{n.f()}}}},{key:"report",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{if(!this.reporter)return this.queue.push({event:t,value:e}),void this.init();var n=l({type:t===p.ERROR?"error":"custom"},e);this.reporter.tech(t,n)}catch(t){console.error(t)}}}]),t}()),g="KV_CONFIG_SDK",m=function(){function t(e){var n=e.appKey,r=e.nscode;c(this,t),this.appKey=void 0,this.appKeyStorageName=void 0,this.appKey=n,this.appKeyStorageName="".concat(n,"_").concat(r),this.checkLocalStorage()}return u(t,[{key:"checkLocalStorage",value:function(){var e=t.getLocalStorage();if(e){for(var n in e){var r=(new Date).getTime();e[n].timestamp+e[n].expires<r&&delete e[n]}Object.keys(e).length>40&&Object.keys(e).sort((function(t,n){return e[t].lastUsed-e[n].lastUsed})).slice(40).forEach((function(t){delete e[t]})),t.setLocalStorage(e)}}},{key:"getAppKey",value:function(){var e=t.getLocalStorage()||{};return e[this.appKeyStorageName]?(e[this.appKeyStorageName].lastUsed=(new Date).getTime(),t.setLocalStorage(e),e[this.appKeyStorageName]||{}):{}}},{key:"setAppkey",value:function(e){var n=l({timestamp:(new Date).getTime(),lastUsed:(new Date).getTime()},e),r=t.getLocalStorage()||{};r[this.appKeyStorageName]=n,t.setLocalStorage(r)}}],[{key:"getLocalStorage",value:function(){var t;try{(t=localStorage.getItem(g))&&(t=JSON.parse(t))}catch(e){console.error("从本地获取".concat(g,"的时候异常"),e),t=void 0,y.report(p.ERROR,{message:"从本地获取".concat(g,"的时候异常").concat(e.message||"")})}return t}},{key:"setLocalStorage",value:function(t){try{localStorage.setItem(g,JSON.stringify(t))}catch(t){!function(t){var e=!1;if(t)if(t.code)switch(t.code){case 22:e=!0;break;case 1014:"NS_ERROR_DOM_QUOTA_REACHED"===t.name&&(e=!0)}else-2147024882===t.number&&(e=!0);return e}(t)?(console.log("storage 更新失败",t),y.report(p.ERROR,{message:"storage 更新失败".concat(t.message||"")})):(console.log("storage 超出浏览器限制",t),y.report(p.ERROR,{message:"storage 超出浏览器限制".concat(t.message||"")}))}}}]),t}();function b(t,e,n){return new Promise((function(r,o){(function(t,e){return new Promise((function(n,r){var o=new XMLHttpRequest;function i(){if(o){var t=o.responseType,e=function(t){var e=t.trim().split(/[\r\n]+/),n={};return e.forEach((function(t){var e=t.split(": "),r=e.shift(),o=e.join(": ");r&&(n[r]=o)})),n}(o.getAllResponseHeaders());!o.status||o.status>=200&&o.status<=299?n({data:t&&"text"!==t?o.response:o.responseText,status:o.status,statusText:o.statusText,headers:e}):r(new Error("Request Error: ".concat(o.status," ").concat(o.statusText))),o=null}}if(o.open((null==e?void 0:e.method)||"GET",t,!0),o.timeout=(null==e?void 0:e.timeout)||2e3,o.responseType=(null==e?void 0:e.responseType)||"json",o.onreadystatechange=function(){o&&4===o.readyState&&(0!==o.status||o.responseURL&&0===o.responseURL.indexOf("file:"))&&setTimeout(i)},o.onabort=function(){o&&(r(new Error("Request aborted: ".concat(t))),o=null)},o.onerror=function(){r(new Error("Network Error: ".concat(t))),o=null},o.ontimeout=function(){r(null!=e&&e.timeout?"Timeout exceeded: ".concat(e.timeout):"Timeout exceeded"),o=null},o.withCredentials=(null==e?void 0:e.withCredentials)||!1,null!=e&&e.headers)for(var a in e.headers)o.setRequestHeader(a,e.headers[a]);o.send((null==e?void 0:e.data)||null)}))})(function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,o=n?Object.keys(n).map((function(t){return"".concat(t,"=").concat(n[t])})).join("&"):"";return"".concat((e=null==r?void 0:r.baseURL,e||"".concat(window.location.protocol,"//").concat(v.split(".").map((function(t,e){return 1===e?window.atob(t):t})).join(".")))).concat(t).concat(o?"?"+o:"")}(t,e,n),{method:"GET"}).then((function(t){var e=t.data,n=void 0===e?{}:e;0===n.code?r(n):o(n)}),(function(t){o(t)})).catch((function(t){o(t)}))}))}var w=function(){function e(t){c(this,e),this.options={appKey:"",apiURL:"",nscode:0,expires:h,strict:f.STRICT},this.storage=void 0,this.fetchPromise=void 0,this.flattenValue={},this.nestedValue={};var n=t.appKey,r=t.expires,o=void 0===r?h:r;this.options=l({},this.options,t,{expires:Math.min(o,h)}),this.storage=new m({appKey:n,nscode:this.options.nscode});var i=this.storage.getAppKey(),a=i.value,s=i.versionId;this.updateValue(a||{}),(this.options.strict!==f.NON_STRICT||t.autoFetch)&&(this.fetchPromise=this.fetchAppKey(s)),this.report(p.PV)}var n,r,i,s,v,g;return u(e,[{key:"getAll",value:(g=a(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.getBase(d.APP));case 1:case"end":return t.stop()}}),t,this)}))),function(){return g.apply(this,arguments)})},{key:"getGroup",value:(v=a(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.getBase(d.GROUP,e));case 1:case"end":return t.stop()}}),t,this)}))),function(t){return v.apply(this,arguments)})},{key:"get",value:(s=a(o().mark((function t(e){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.getBase(d.KEY,e));case 1:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)})},{key:"getBase",value:(i=a(o().mark((function e(n){var r,i,a,c,s=this,u=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>1&&void 0!==u[1]?u[1]:"",i=function(){if(n===d.APP)return s.nestedValue;if(n===d.GROUP)return s.nestedValue[r]||{};var e=t(r.split("."),2),o=e[0],i=e[1];return s.nestedValue[o]?s.nestedValue[o][i]:""},this.options.strict!==f.NON_STRICT){e.next=4;break}return e.abrupt("return",i());case 4:return this.fetchPromise||(a=this.storage.getAppKey(),c=a.versionId,this.fetchPromise=this.fetchAppKey(c)),e.abrupt("return",this.fetchPromise.then((function(){return i()})));case 6:case"end":return e.stop()}}),e,this)}))),function(t){return i.apply(this,arguments)})},{key:"fetchAppKey",value:(r=a(o().mark((function t(e){var n,r,i,a,c;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.options,r=n.appKey,i=n.nscode,t.prev=1,t.next=4,b("/x/kv-frontend/namespace/data",{appKey:r,versionId:e,nscode:i},{baseURL:this.options.apiURL});case 4:a=t.sent,c=a.data,this.storage.setAppkey({value:c.data,versionId:c.versionId,appVersionId:c.appVersionId,nscode:i,appKey:this.options.appKey,expires:this.options.expires}),this.updateValue(c.data),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1),-304!==t.t0.code?console.error(t.t0):this.report(p.ERROR,{message:t.t0.message||t.t0.msg||"获取失败"});case 12:case"end":return t.stop()}}),t,this,[[1,9]])}))),function(t){return r.apply(this,arguments)})},{key:"updateValue",value:function(e){var n=this;this.flattenValue=e;var r={};Object.keys(this.flattenValue).forEach((function(e){var o=t(e.split("."),2),i=o[0],a=o[1];r[i]||(r[i]={}),r[i][a]=n.flattenValue[e]})),this.nestedValue=r}},{key:"report",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};y.report(t,l({appKey:this.options.appKey,nscode:this.options.nscode,sdkVersion:"1.2.4"},e))}}],[{key:"updateLocalAppKey",value:(n=a(o().mark((function t(e){var n,r,i,a,c,s,u,f;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=e.appKey,r=e.appVersionId,i=e.apiBaseURL,a=m.getLocalStorage()){t.next=4;break}return t.abrupt("return");case 4:if(c=Object.keys(a).filter((function(t){return a[t].appKey===n&&a[t].appVersionId!==r})).map((function(t){return a[t]})),c.length){t.next=7;break}return t.abrupt("return");case 7:return t.next=9,b("/x/kv-frontend/app/batchupdates",{appKey:n,batches:JSON.stringify(c.map((function(t){return{appVersionId:t.appVersionId,nscode:t.nscode}})))},{baseURL:i});case 9:s=t.sent,u=s.data,f=m.getLocalStorage()||{},u.forEach((function(t){var e="".concat(n,"_").concat(t.nscode);if(t.deleted)delete f[e];else if(t.updated){var r={timestamp:(new Date).getTime(),value:t.data,versionId:t.versionId,appVersionId:t.appVersionId,nscode:t.nscode,appKey:n};f[e]=l({},f[e]||{},r)}})),m.setLocalStorage(f),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(0),-304!==t.t0.code&&console.error(t.t0);case 18:case"end":return t.stop()}}),t,null,[[0,15]])}))),function(t){return n.apply(this,arguments)})}]),e}(),_=function(t,e){e||(e={});for(var n=!1===e.decode,r=e.template||document.cookie,o={},i=(n?r:decodeURIComponent(r)).split(";"),a=!0===t,c=0;c<i.length;c++){for(var s=i[c];" "===s.charAt(0);)s=s.substring(1);var u=s.split("="),l=u[0],f=u[1];if(o[l]=f,t===l)return o[t]}return a?o:""},E={};function x(t){return t&&"object"==r(t)&&"default"in t?t.default:t}Object.defineProperty(E,"__esModule",{value:!0}),E.BUTILS_CACHE="__butils_cache",E.CACHED_SCRIPTS="$butils_scripts",E.CACHED_STYLES="$butils_styles",E.DAY_TIME=864e5,E.DAY_TIME_1=86399999,E.HTML_ESCAPES={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},E.HTML_UNESCAPES={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},E.ID_CHAR_SET={number:"0123456789",letter:"abcdefghijklmnopqrstuvwxyz",special:"~`!@#$%^&*()-_+=[]{};:\"',<.>/?"},E.RE_BASE64=/^((data:.*;)?base64,)?([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,E.RE_CN_CHAR=/^[\u4e00-\u9fa5]*$/,E.RE_DB_CHAR=/^[^x00-xff]*$/,E.RE_DOMAIN=/^([0-9a-z_!~*'()-]+\.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z]\.[a-z]{2,6}$/,E.RE_EMAIL=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,E.RE_ID_CARD=/^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$|^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$/,E.RE_ID_CARD_V1=/^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$/,E.RE_ID_CARD_V2=/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$/,E.RE_IPV4=/^((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$/,E.RE_MONTH=/^(0?[1-9]|1[0-2])$/,E.RE_MONTH_DAY=/^((0?[1-9])|((1|2)[0-9])|30|31)$/,E.RE_PHONE=/^(\+?0?86-?)?1[3456789]\d{9}$/,E.RE_PROT=/^[1-9][0-9]{0,3}|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5]$/,E.RE_QQ=/^[1-9][0-9]{4,}$/,E.RE_TEL=/^((\d{3,4})|\d{3,4}-)?\d{7,8}?$/,E.RE_URL=/^(https?:)?(\/\/)?(((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)|([0-9a-z_!~*'()-]+\.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z]\.[a-z]{2,6})(:[0-9]{1-6})?([-0-9a-zA-Z+&@#/%=~_|?!:,.;]*)?$/,E.RE_URL_DOMAIN=/^(https?:)?\/\/([0-9a-z_!~*'()-]+\.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z]\.[a-z]{2,6}(:[0-9]{1-6})?([-0-9a-zA-Z+&@#/%=~_|?!:,.;]*)?$`/,E.RE_URL_IP=/^(https?:)?\/\/((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)(:[0-9]{1-6})?([-0-9a-zA-Z+&@#/%=~_|?!:,.;]*)?$`/,E.RE_URL_SUFFIX=/^[-0-9a-zA-Z+&@#/%=~_|?!:,.;]*$/,E.RE_UUID=/^[0-9a-zA-Z]{8}-([0-9a-zA-Z]{4}-){3}[0-9a-zA-Z]{12}$/,E.RE_ZIP_CODE=/^[1-9]\d{5}(?!\d)$/;var S,k,R,A,O=x((function(t,e){var n="number"==typeof t;return e?n:n&&!Number.isNaN(t)&&Number.isFinite(t)})),L=x((function(t){return"string"==typeof t})),T=E,I=function(t,e,n){var r="",o=0;if(!1!==(n=n||{}).encode&&(e=encodeURIComponent(e)),O(n.exMinuts)&&(o+=6e4*n.exMinuts),O(n.exDays)&&(o+=n.exDays*T.DAY_TIME),o){var i=new Date;i.setTime(i.getTime()+o),r=";expires=".concat(i.toUTCString())}var a=L(n.domain)?";domain=".concat(n.domain):"";document.cookie="".concat(t,"=").concat(e).concat(r,";path=/").concat(a)},D=(S=I)&&"object"==r(S)&&"default"in S?S.default:S;!function(t){t.I="i"}(k||(k={})),function(t){t.Off="0",t.On="1"}(R||(R={})),function(t){t[t.Goahead=0]="Goahead",t[t.Last=1]="Last",t[t.End=2]="End"}(A||(A={}));var N="bmg_af_wl",P="bmg_af_dft",C="bmg_af_switch",j="bmg_src_def_domain",K=function(){function t(t){if(this.defDomain="",this.on=!1,this.config={fr:!1,def:"",dl:[]},this.wl=[],this.defUpdated=!1,this.connectivities={},this.x=1,"undefined"!=typeof window)return this.defFallbackThreshold=(null==t?void 0:t.defFallbackThreshold)||Number(this.getLocalStorage(P,!0)||"5"),window.__BMG_AF__?(this.config=window.__BMG_AF__.config,this.defDomain=window.__BMG_AF__.defDomain,this.x=window.__BMG_AF__.x,this.on=window.__BMG_AF__.on,this):(window.__BMG_AF__=this,this.on=_(C,{decode:!1})===R.On,this.on&&(this.defDomain=_(j,{decode:!1})),this.getX(document.cookie),this.initConfig(!0),void this.syncConfig());this.defFallbackThreshold=(null==t?void 0:t.defFallbackThreshold)||5,(null==t?void 0:t.cookie)&&(this.on=_(C,{template:t.cookie,decode:!1})===R.On,this.on&&(this.defDomain=_(j,{template:t.cookie,decode:!1})),this.getX(t.cookie)),this.initConfig(!1)}return t.prototype.getX=function(t){var e="",n=_("buvid3",{template:t,decode:!1});if(n&&(e=n.substring(0,2)),e){var r=parseInt(e,16);isNaN(r)||(this.x=Math.round(r/2.56))}},t.prototype.checkWlConfig=function(e){try{var n=!0,r=JSON.parse(e);if(Array.isArray(r)&&r.length)for(var o=0;o<r.length;o++)if("number"!=typeof r[o]||isNaN(r[o])){n=!1;break}if(n&&r.length)return r}catch(e){}return t.DEF_WL},t.prototype.initConfig=function(e){if(this.defDomain){var n=[],r=this.defDomain;e?(this.wl=this.checkWlConfig(this.getLocalStorage(N,!1)),n=this.getDl(k.I,this.wl)):n=this.getDl(k.I,t.DEF_WL);var o=n[0];if(o){if(r&&r!==o&&r.match(this.domainRegExp)){var i=n.indexOf(r);i>-1&&(n.splice(i,1),n.unshift(r),o=r)}else e&&I(j,o);this.defDomain=o,this.config={fr:!1,def:o,dl:n}}}},t.prototype.getDomain=function(t,e,n){return void 0===n&&(n=".hdslb.com"),"".concat(t).concat(e).concat(n)},t.prototype.getDl=function(t,e){var n=this,r=this.x,o=e.map((function(t,e){return{n:t*Math.random(),i:e}})).filter((function(t){return t.n>0}));if(r<100||r>=0){for(var i=e.reduce((function(t,e){return t+e}),0),a=0,c=0;a<e.length-1;a++){var s=c+e[a+1]/i*100;if(!(r>c))break;if(s>=r)break;c=s}o[a].n=i}return o.sort((function(t,e){return e.n-t.n})).map((function(e){var r=e.i;return n.getDomain(t,r)}))},Object.defineProperty(t.prototype,"domainRegExp",{get:function(){return new RegExp(this.getDomain("(s|i)","\\d"))},enumerable:!1,configurable:!0}),t.prototype.recordConnectivity=function(t,e){if("undefined"!=typeof window&&window.__BMG_AF__){var n=this.config.def,r=t.match(this.domainRegExp);if(null==r?void 0:r[0]){var o=null==r?void 0:r[0];o in this.connectivities?this.connectivities[o][e?"success":"fail"]++:this.connectivities[o]={success:Number(e),fail:Number(!e),fallback:o!==n};var i=this.connectivities[o],a=i.fallback,c=i.success,s=(this.connectivities[n]||{fail:0}).fail;a&&!this.defUpdated&&c&&s>this.defFallbackThreshold&&this.updateDefDomain(o)}}},t.prototype.updateDefDomain=function(t){this.defDomain=t,this.config.def=t;var e=this.config.dl.indexOf(t);e>-1&&1!==e&&(this.config.dl.splice(e,1),this.config.dl.splice(1,0,t)),I(j,t),this.dispatchEvent("bmg-src-default-domain-change",{domain:t}),this.defUpdated=!0},t.prototype.getNext=function(t){if(!this.on)return null;if(!this.config.def)return null;var e=t.match(this.domainRegExp);if(null==e?void 0:e[0]){var n=this.config.dl,r=n.indexOf(e[0]);if(r>-1){var o=-1===t.indexOf("/bfs/");return r===n.length-1?o||-1===t.indexOf("@")?null:{src:t.split("@")[0],strategy:A.End}:{src:t.replace(this.domainRegExp,n[r+1]),strategy:r===n.length-2?o?A.End:A.Last:A.Goahead}}}return null},t.prototype.syncConfig=function(){return function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function c(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((r=r.apply(t,e||[])).next())}))}(this,void 0,void 0,(function(){var t,e,n,r,o,i,a,c=this;return function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(t){c=[6,t],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(s){switch(s.label){case 0:return this.config.fr?this.config.fr instanceof Promise?[4,this.config.fr]:[3,2]:[3,3];case 1:s.sent(),s.label=2;case 2:return[2];case 3:t=null,e=new Promise((function(e){t=e})),this.config.fr=e,e.then((function(t){c.config.fr=t})),s.label=4;case 4:return s.trys.push([4,6,,7]),[4,new w({appKey:"333.1339",apiURL:"//api.bilibili.com",strict:f.STRICT,nscode:1}).getGroup("fallback")];case 5:if(n=s.sent()){if((r=n.on===R.On)?this.on||I(C,R.On):(function(t,e){D(t,"",{exDays:-1,domain:e})}(j),I(C,R.Off)),!r)return[2,t(!0)];n.i&&(o=this.checkWlConfig(n.i),JSON.stringify(o)!==JSON.stringify(this.wl)&&(i=this.getDl(k.I,o),(a=i[0])!==this.config.def&&(this.config.def=a,I(j,a)),this.config.dl=i,this.setLocalStorage(N,o))),n.dft&&this.setLocalStorage(P,n.dft),t(!0)}else t(!1);return[3,7];case 6:return s.sent(),t(!1),[3,7];case 7:return[2]}}))}))},t.prototype.getLocalStorage=function(t,e){if("undefined"==typeof localStorage)return null;var n="";try{return"string"!=typeof(n=localStorage.getItem(t))||!1===e?n:JSON.parse(n)}catch(t){return n||null}},t.prototype.setLocalStorage=function(t,e){if("undefined"==typeof localStorage)return!1;try{return localStorage.setItem(t,JSON.stringify(e)),!0}catch(t){return!1}},t.prototype.dispatchEvent=function(t,e){void 0!==window.CustomEvent?document.dispatchEvent(new CustomEvent(t,{detail:e})):console.warn("This browser not support custom event")},t.prototype.callReport=function(t,e){window.__biliMirrorPbInstance__&&window.__biliMirrorPbInstance__.tech(t,e)},t.prototype.handleImgEvent=function(t,e){var n;if(this.on&&e instanceof HTMLImageElement){var r=e.currentSrc||e.src,o=e.getAttribute("fallback");if("load"===t)return o&&this.callReport("bmg_fallback.success",{}),void this.recordConnectivity(r,!0);if(this.recordConnectivity(r,!1),o!==A.End.toString()){var i=this.getNext(r);if(i&&i.src!==r){if(e.setAttribute("fallback",i.strategy.toString()),"PICTURE"===(null===(n=e.parentElement)||void 0===n?void 0:n.tagName)){var a=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,i=e.length;o<i;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}([],e.parentElement.getElementsByTagName("source")||[],!0);a.forEach((function(t){var n;null===(n=e.parentElement)||void 0===n||n.removeChild(t)}))}e.src=i.src}else e.setAttribute("fallback",A.End.toString())}}},t.DEF_WL=[1,1,1],t.getWindowSrcDefDomain=function(){var t,e;return(null===(e=null===(t=window.__BMG_AF__)||void 0===t?void 0:t.config)||void 0===e?void 0:e.def)||""},t}(),M=window;M.__BMG_AF__||new K,M.imgAutoFallbackError||(M.imgAutoFallbackOnLoad=function(t){window.__BMG_AF__&&window.__BMG_AF__.handleImgEvent("load",t)},M.imgAutoFallbackOnError=function(t){setTimeout((function(){window.__BMG_AF__.handleImgEvent("error",t)}),200)})}));
