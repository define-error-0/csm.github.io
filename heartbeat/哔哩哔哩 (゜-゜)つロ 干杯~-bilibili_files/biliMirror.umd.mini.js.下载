!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).biliMirror={})}(this,(function(e){"use strict";function t(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;let n=!1;function r(){return!1===n&&(n="undefined"!=typeof window),n}var i;const o=function(){if(r())return window}();function s(){if(r())return o.__biliMirror__=o.__biliMirror__||{},o.__biliMirror__}const a=r()&&(null===(i=document.getElementsByTagName("meta").spm_prefix)||void 0===i?void 0:i.content)||"0.0";function c(e,t,n,r=!1){e.addEventListener(t,n,r)}function l(){return Date.now()}const u=Object.prototype.toString;function d(e){return function(t){return u.call(t)===`[object ${e}]`}}const f={isNumber:d("Number"),isString:d("String"),isBoolean:d("Boolean"),isNull:d("Null"),isUndefined:d("Undefined"),isSymbol:d("Symbol"),isFunction:d("Function"),isObject:d("Object"),isArray:d("Array"),isProcess:d("process"),isWindow:d("Window")};function p(e){const t=/^[0-9a-zA-Z_-]+$/.test(e);return t||console.warn(`字符串:${e},不符合条件,任意数字,字母、下划线、中划线组成`),t}const m=(e,t=["chrome-extension"])=>{if(0===t.length)return!1;if(null==(null==e?void 0:e.message))return!0;const[n]=e.message.split("?");if(n.includes(location.hostname))return!0;const r=(null==e?void 0:e.fileName)||"";return t.map((e=>new RegExp(String.raw`${e}`))).some((e=>e.test(n)||e.test(r)))};function h(e){if("0"===e)return 0;if(f.isNumber(e))return e>10?10:e<=0?1:e;if(f.isString(e)&&!isNaN(e)){const t=parseInt(e);return t>10?10:t<=0?1:t}return console.warn("mirror-kv-[config] sampling rate error,pleace set 1-10"),1}function g(e){return Math.floor(10*Math.random()+1)>e}function v(){return"undefined"==typeof document||null==document.location?"":document.location.href}function b(e){if(!e)return{};const t=e.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};const n=t[6]||"",r=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],relative:t[5]+n+r}}function y(e,t,n,r=!1){if(void 0!==e&&(t in e||r)){const r=n(e[t]);"function"==typeof r&&(e[t]=r)}}const w=(e,t)=>{let n=!0;return function(...r){n&&(e.apply(this,r),n=!1,setTimeout((()=>{n=!0}),t))}},E=(e,t)=>{let n;return function(...r){clearTimeout(n),n=setTimeout((()=>{e.apply(this,r)}),t)}};function O(e){return e&&"object"==typeof e&&!Array.isArray(e)}function S(e,t){let n=Object.assign({},e);return O(e)&&O(t)&&Object.keys(t).forEach((r=>{O(t[r])?r in e?n[r]=S(e[r],t[r]):Object.assign(n,{[r]:t[r]}):Object.assign(n,{[r]:t[r]})})),n}var R="1.6.1";const I="@bilibili/bili-mirror",_=R;var k=function(e){"undefined"!=typeof window&&window.__BILI_X_ENGINE_SCRIPT_CACHE__&&void 0!==window.__BILI_X_ENGINE_SCRIPT_CACHE__[e]&&delete window.__BILI_X_ENGINE_SCRIPT_CACHE__[e]},C=function(e,t){if("undefined"==typeof window)return Promise.reject(new Error("window is not defined"));var n,r=e=e.replace(/^https?:\/\//,"//"),i=(n=r,"undefined"==typeof window?null:window.__BILI_X_ENGINE_SCRIPT_CACHE__&&window.__BILI_X_ENGINE_SCRIPT_CACHE__[n]||null);if(null!=i&&i.promise)return i.promise;var o=new Promise((function(n,r){var i=document.createElement("script");i.src=e,null!=t&&t.behavior&&i.setAttribute(t.behavior,""),i.onload=function(){var i=window;if(t.lib)return i[t.lib]?n(i[t.lib]):r(new Error('Failed to access library "'+t.lib+'" from '+e));n(null)},i.onerror=function(){r(new Error("Failed to load "+e))},document.head.appendChild(i)}));return function(e,t){"undefined"!=typeof window&&(window.__BILI_X_ENGINE_SCRIPT_CACHE__||(window.__BILI_X_ENGINE_SCRIPT_CACHE__={}),window.__BILI_X_ENGINE_SCRIPT_CACHE__[e]=t)}(r,{promise:o,lib:null==t?void 0:t.lib}),o.then((function(){!1===(null==t?void 0:t.cache)&&k(r)})).catch((function(){!1===(null==t?void 0:t.cache)&&k(r)})),o},T=function(e){return Promise.resolve(function(){try{return window.KvSDK?Promise.resolve(window.KvSDK):Promise.resolve(C("//s1.hdslb.com/bfs/seed/jinkela/kv-sdk/index.js",{lib:"KvSDK"}))}catch(e){return Promise.reject(e)}}()).then((function(t){return new t(e)}))},N=function(e){return Promise.resolve(function(){try{return window.ReporterPb?Promise.resolve(window.ReporterPb):Promise.resolve(C("//s1.hdslb.com/bfs/seed/jinkela/short/reporter-pb/index.js",{lib:"ReporterPb"}))}catch(e){return Promise.reject(e)}}()).then((function(t){return new t(e)}))};const P=s(),$={SPMID:"333.1333",GROUP:"bilimirror",KEY:"whitelist"};class j{constructor(){this.origin="bili",this.module="common",this.config={},this.kvOptions={},this._defaultKvConfig={retry:[],performance:1,poll:5,techpv:5,userLog:[],resourceTime:{},userLogDeep:10,track:{}}}fetchWhiteListConfig(e,t){return new Promise(((n,r)=>{e.get(t).then((t=>{if(!t)return console.warn(`${e.storage.appKey}-没有对应配置,返回默认配置`),void n(this._defaultKvConfig);const r=JSON.parse(t);n(r)})).catch((t=>{console.warn(`${e.storage.appKey},mirror获取白名单配置失败,返回默认配置`),n(this._defaultKvConfig)}))}))}getConfig(){return t(this,void 0,void 0,(function*(){this._defaultConfigSDK=yield T(Object.assign({appKey:$.SPMID,strict:1},this.kvOptions));const{SPMID:e,GROUP:t,KEY:n}=$,r=this.spmId||a,i=yield this.fetchWhiteListConfig(this._defaultConfigSDK,`${t}.${n}`);let o={};e!==r&&(this._configSDK&&delete this._configSDK,this._configSDK=yield T(Object.assign({appKey:r,strict:1},this.kvOptions)),o=yield this.fetchWhiteListConfig(this._configSDK,`${t}.${n}`));const s=S(i,o);return new Promise((e=>{this.config.white=(null==s?void 0:s.white)||{},this.config["white-retry"]=(null==s?void 0:s.retry)||[],this.config["white-preformance-rate"]=s.performance?h(null==s?void 0:s.performance):1,this.config["poll-time"]=s.poll?h(null==s?void 0:s.poll):5,this.config["tech-pv"]=s.techpv?h(null==s?void 0:s.techpv):5,this.config["user-log"]=(null==s?void 0:s.userLog)||[],this.config["resource-time"]=(null==s?void 0:s.resourceTime)||{},this.config["user-log-deep"]=(null==s?void 0:s.userLogDeep)||10,this.config.track=(null==s?void 0:s.track)||{},e()}))}))}bindOptions(e={}){return t(this,void 0,void 0,(function*(){return P.mirrorVersion=_,Object.keys(e).forEach((t=>{"config"!==t&&("module"===t&&"function"==typeof e[t]?this[t]=e[t]():this[t]=e[t])})),yield this.getConfig(),Promise.resolve("ok")}))}updateModule(e){this.module=e}}function A(){return P.options||(P.options=new j)}const M=r()?A():null;function B(e={}){return t(this,void 0,void 0,(function*(){if(r()){return yield M.bindOptions(e)}}))}var D,L,H,x,J=-1,U=function(e){addEventListener("pageshow",(function(t){t.persisted&&(J=t.timeStamp,e(t))}),!0)},F=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},W=function(){var e=F();return e&&e.activationStart||0},K=function(e,t){var n=F(),r="navigate";return J>=0?r="back-forward-cache":n&&(document.prerendering||W()>0?r="prerender":document.wasDiscarded?r="restore":n.type&&(r=n.type.replace(/_/g,"-"))),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:r}},Y=function(e,t,n){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var r=new PerformanceObserver((function(e){Promise.resolve().then((function(){t(e.getEntries())}))}));return r.observe(Object.assign({type:e,buffered:!0},n||{})),r}}catch(e){}},G=function(e,t,n,r){var i,o;return function(s){t.value>=0&&(s||r)&&((o=t.value-(i||0))||void 0===i)&&(i=t.value,t.delta=o,t.rating=function(e,t){return e>t[1]?"poor":e>t[0]?"needs-improvement":"good"}(t.value,n),e(t))}},V=function(e){requestAnimationFrame((function(){return requestAnimationFrame((function(){return e()}))}))},q=function(e){var t=function(t){"pagehide"!==t.type&&"hidden"!==document.visibilityState||e(t)};addEventListener("visibilitychange",t,!0),addEventListener("pagehide",t,!0)},X=function(e){var t=!1;return function(n){t||(e(n),t=!0)}},Q=-1,z=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},Z=function(e){"hidden"===document.visibilityState&&Q>-1&&(Q="visibilitychange"===e.type?e.timeStamp:0,te())},ee=function(){addEventListener("visibilitychange",Z,!0),addEventListener("prerenderingchange",Z,!0)},te=function(){removeEventListener("visibilitychange",Z,!0),removeEventListener("prerenderingchange",Z,!0)},ne=function(){return Q<0&&(Q=z(),ee(),U((function(){setTimeout((function(){Q=z(),ee()}),0)}))),{get firstHiddenTime(){return Q}}},re=function(e){document.prerendering?addEventListener("prerenderingchange",(function(){return e()}),!0):e()},ie=[1800,3e3],oe=function(e,t){t=t||{},re((function(){var n,r=ne(),i=K("FCP"),o=Y("paint",(function(e){e.forEach((function(e){"first-contentful-paint"===e.name&&(o.disconnect(),e.startTime<r.firstHiddenTime&&(i.value=Math.max(e.startTime-W(),0),i.entries.push(e),n(!0)))}))}));o&&(n=G(e,i,ie,t.reportAllChanges),U((function(r){i=K("FCP"),n=G(e,i,ie,t.reportAllChanges),V((function(){i.value=performance.now()-r.timeStamp,n(!0)}))})))}))},se=[.1,.25],ae={passive:!0,capture:!0},ce=new Date,le=function(e,t){D||(D=t,L=e,H=new Date,fe(removeEventListener),ue())},ue=function(){if(L>=0&&L<H-ce){var e={entryType:"first-input",name:D.type,target:D.target,cancelable:D.cancelable,startTime:D.timeStamp,processingStart:D.timeStamp+L};x.forEach((function(t){t(e)})),x=[]}},de=function(e){if(e.cancelable){var t=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?function(e,t){var n=function(){le(e,t),i()},r=function(){i()},i=function(){removeEventListener("pointerup",n,ae),removeEventListener("pointercancel",r,ae)};addEventListener("pointerup",n,ae),addEventListener("pointercancel",r,ae)}(t,e):le(t,e)}},fe=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,de,ae)}))},pe=[100,300],me=[2500,4e3],he={},ge=[800,1800],ve=function e(t){document.prerendering?re((function(){return e(t)})):"complete"!==document.readyState?addEventListener("load",(function(){return e(t)}),!0):setTimeout(t,0)},be=function(e,t){t=t||{};var n=K("TTFB"),r=G(e,n,ge,t.reportAllChanges);ve((function(){var i=F();if(i){var o=i.responseStart;if(o<=0||o>performance.now())return;n.value=Math.max(o-W(),0),n.entries=[i],r(!0),U((function(){n=K("TTFB",0),(r=G(e,n,ge,t.reportAllChanges))(!0)}))}}))};const ye=e=>!!r()&&(()=>{try{return r()&&PerformanceObserver?PerformanceObserver.supportedEntryTypes||[]:null}catch(e){console.error("bili-mirror: supportList 解析异常:",e)}})().includes(e);function we(e){window.performance.getEntriesByType&&window.addEventListener("load",(function(){const t=window.performance;t&&setTimeout((()=>{const n=t.getEntriesByType("navigation")[0],r={redirectTime:n.redirectEnd-n.redirectStart,dnsTime:n.domainLookupEnd-n.domainLookupStart,tcpTime:n.connectEnd-n.connectStart,sslTime:"https:"===location.protocol?n.connectEnd-n.secureConnectionStart:0,ttfbTime:n.responseStart-n.startTime,requestDoneTime:n.responseEnd-n.responseStart,domParseTime:n.domContentLoadedEventEnd-n.responseEnd,resourceDownloadTime:n.loadEventEnd-n.domContentLoadedEventEnd,pageTime:n.duration};e({name:"PAGETIME",data:r,value:1})}),0)}))}function Ee(e){/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)?(!function(e){if(!ye("first-input"))return;const t=new PerformanceObserver((n=>{for(const r of n.getEntries()){t.disconnect();const n=r.processingStart-r.startTime;e({name:"FID",value:n,rating:n<100?"good":n>100&&n<300?"normal":"poor"})}}));t.observe({type:"first-input",buffered:!0})}((t=>{e(t)})),function(e){if(!ye("paint"))return;const t=new PerformanceObserver((n=>{for(const r of n.getEntries())"first-contentful-paint"===r.name&&(t.disconnect(),e({name:"FCP",value:r.startTime,rating:r.startTime<1600?"good":r.startTime>1600&&r.startTime<3e3?"normal":"poor"}))}));t.observe({type:"paint",buffered:!0})}((t=>{e(t)})),function(e){if(!ye("largest-contentful-paint"))return;const t=new PerformanceObserver((n=>{for(const r of n.getEntries())t.disconnect(),e({name:"LCP",value:r.startTime,rating:r.startTime<1600?"good":r.startTime>1600&&r.startTime<3e3?"normal":"poor"})}));t.observe({type:"largest-contentful-paint",buffered:!0})}((t=>{e(t)})),function(e){window.addEventListener("load",(function(){let{responseStart:t,navigationStart:n}=window.performance.timing,r=t-n;e({name:"TTFB",value:r,rating:r<200?"good":r>200&&r<500?"normal":"poor"})}))}((t=>{e(t)})),we((t=>{e(t)}))):(!function(e,t){t=t||{},re((function(){var n,r=ne(),i=K("LCP"),o=function(e){var t=e[e.length-1];t&&t.startTime<r.firstHiddenTime&&(i.value=Math.max(t.startTime-W(),0),i.entries=[t],n())},s=Y("largest-contentful-paint",o);if(s){n=G(e,i,me,t.reportAllChanges);var a=X((function(){he[i.id]||(o(s.takeRecords()),s.disconnect(),he[i.id]=!0,n(!0))}));["keydown","click"].forEach((function(e){addEventListener(e,a,!0)})),q(a),U((function(r){i=K("LCP"),n=G(e,i,me,t.reportAllChanges),V((function(){i.value=performance.now()-r.timeStamp,he[i.id]=!0,n(!0)}))}))}}))}((t=>{e(t)})),function(e,t){t=t||{},re((function(){var n,r=ne(),i=K("FID"),o=function(e){e.startTime<r.firstHiddenTime&&(i.value=e.processingStart-e.startTime,i.entries.push(e),n(!0))},s=function(e){e.forEach(o)},a=Y("first-input",s);n=G(e,i,pe,t.reportAllChanges),a&&q(X((function(){s(a.takeRecords()),a.disconnect()}))),a&&U((function(){var r;i=K("FID"),n=G(e,i,pe,t.reportAllChanges),x=[],L=-1,D=null,fe(addEventListener),r=o,x.push(r),ue()}))}))}((t=>{e(t)})),function(e,t){t=t||{},oe(X((function(){var n,r=K("CLS",0),i=0,o=[],s=function(e){e.forEach((function(e){if(!e.hadRecentInput){var t=o[0],n=o[o.length-1];i&&e.startTime-n.startTime<1e3&&e.startTime-t.startTime<5e3?(i+=e.value,o.push(e)):(i=e.value,o=[e])}})),i>r.value&&(r.value=i,r.entries=o,n())},a=Y("layout-shift",s);a&&(n=G(e,r,se,t.reportAllChanges),q((function(){s(a.takeRecords()),n(!0)})),U((function(){i=0,r=K("CLS",0),n=G(e,r,se,t.reportAllChanges),V((function(){return n()}))})),setTimeout(n,0))})))}((t=>{e(t)})),oe((t=>{e(t)})),be((t=>{e(t)})),we((t=>{e(t)})))}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function Oe(e,t){return e(t={exports:{}},t.exports),t.exports}var Se=Oe((function(e,t){e.exports=function(){var e=1e3,t=6e4,n=36e5,r="millisecond",i="second",o="minute",s="hour",a="day",c="week",l="month",u="quarter",d="year",f="date",p="Invalid Date",m=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,h=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},v=function(e,t,n){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},b={s:v,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),i=n%60;return(t<=0?"+":"-")+v(r,2,"0")+":"+v(i,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var r=12*(n.year()-t.year())+(n.month()-t.month()),i=t.clone().add(r,l),o=n-i<0,s=t.clone().add(r+(o?-1:1),l);return+(-(r+(n-i)/(o?i-s:s-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:l,y:d,w:c,d:a,D:f,h:s,m:o,s:i,ms:r,Q:u}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},y="en",w={};w[y]=g;var E="$isDayjsObject",O=function(e){return e instanceof _||!(!e||!e[E])},S=function e(t,n,r){var i;if(!t)return y;if("string"==typeof t){var o=t.toLowerCase();w[o]&&(i=o),n&&(w[o]=n,i=o);var s=t.split("-");if(!i&&s.length>1)return e(s[0])}else{var a=t.name;w[a]=t,i=a}return!r&&i&&(y=i),i||!r&&y},R=function(e,t){if(O(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new _(n)},I=b;I.l=S,I.i=O,I.w=function(e,t){return R(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var _=function(){function g(e){this.$L=S(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[E]=!0}var v=g.prototype;return v.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(I.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(m);if(r){var i=r[2]-1||0,o=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,o)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,o)}}return new Date(t)}(e),this.init()},v.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},v.$utils=function(){return I},v.isValid=function(){return!(this.$d.toString()===p)},v.isSame=function(e,t){var n=R(e);return this.startOf(t)<=n&&n<=this.endOf(t)},v.isAfter=function(e,t){return R(e)<this.startOf(t)},v.isBefore=function(e,t){return this.endOf(t)<R(e)},v.$g=function(e,t,n){return I.u(e)?this[t]:this.set(n,e)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(e,t){var n=this,r=!!I.u(t)||t,u=I.p(e),p=function(e,t){var i=I.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return r?i:i.endOf(a)},m=function(e,t){return I.w(n.toDate()[e].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},h=this.$W,g=this.$M,v=this.$D,b="set"+(this.$u?"UTC":"");switch(u){case d:return r?p(1,0):p(31,11);case l:return r?p(1,g):p(0,g+1);case c:var y=this.$locale().weekStart||0,w=(h<y?h+7:h)-y;return p(r?v-w:v+(6-w),g);case a:case f:return m(b+"Hours",0);case s:return m(b+"Minutes",1);case o:return m(b+"Seconds",2);case i:return m(b+"Milliseconds",3);default:return this.clone()}},v.endOf=function(e){return this.startOf(e,!1)},v.$set=function(e,t){var n,c=I.p(e),u="set"+(this.$u?"UTC":""),p=(n={},n[a]=u+"Date",n[f]=u+"Date",n[l]=u+"Month",n[d]=u+"FullYear",n[s]=u+"Hours",n[o]=u+"Minutes",n[i]=u+"Seconds",n[r]=u+"Milliseconds",n)[c],m=c===a?this.$D+(t-this.$W):t;if(c===l||c===d){var h=this.clone().set(f,1);h.$d[p](m),h.init(),this.$d=h.set(f,Math.min(this.$D,h.daysInMonth())).$d}else p&&this.$d[p](m);return this.init(),this},v.set=function(e,t){return this.clone().$set(e,t)},v.get=function(e){return this[I.p(e)]()},v.add=function(r,u){var f,p=this;r=Number(r);var m=I.p(u),h=function(e){var t=R(p);return I.w(t.date(t.date()+Math.round(e*r)),p)};if(m===l)return this.set(l,this.$M+r);if(m===d)return this.set(d,this.$y+r);if(m===a)return h(1);if(m===c)return h(7);var g=(f={},f[o]=t,f[s]=n,f[i]=e,f)[m]||1,v=this.$d.getTime()+r*g;return I.w(v,this)},v.subtract=function(e,t){return this.add(-1*e,t)},v.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||p;var r=e||"YYYY-MM-DDTHH:mm:ssZ",i=I.z(this),o=this.$H,s=this.$m,a=this.$M,c=n.weekdays,l=n.months,u=n.meridiem,d=function(e,n,i,o){return e&&(e[n]||e(t,r))||i[n].slice(0,o)},f=function(e){return I.s(o%12||12,e,"0")},m=u||function(e,t,n){var r=e<12?"AM":"PM";return n?r.toLowerCase():r};return r.replace(h,(function(e,r){return r||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return I.s(t.$y,4,"0");case"M":return a+1;case"MM":return I.s(a+1,2,"0");case"MMM":return d(n.monthsShort,a,l,3);case"MMMM":return d(l,a);case"D":return t.$D;case"DD":return I.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return d(n.weekdaysMin,t.$W,c,2);case"ddd":return d(n.weekdaysShort,t.$W,c,3);case"dddd":return c[t.$W];case"H":return String(o);case"HH":return I.s(o,2,"0");case"h":return f(1);case"hh":return f(2);case"a":return m(o,s,!0);case"A":return m(o,s,!1);case"m":return String(s);case"mm":return I.s(s,2,"0");case"s":return String(t.$s);case"ss":return I.s(t.$s,2,"0");case"SSS":return I.s(t.$ms,3,"0");case"Z":return i}return null}(e)||i.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(r,f,p){var m,h=this,g=I.p(f),v=R(r),b=(v.utcOffset()-this.utcOffset())*t,y=this-v,w=function(){return I.m(h,v)};switch(g){case d:m=w()/12;break;case l:m=w();break;case u:m=w()/3;break;case c:m=(y-b)/6048e5;break;case a:m=(y-b)/864e5;break;case s:m=y/n;break;case o:m=y/t;break;case i:m=y/e;break;default:m=y}return p?m:I.a(m)},v.daysInMonth=function(){return this.endOf(l).$D},v.$locale=function(){return w[this.$L]},v.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=S(e,t,!0);return r&&(n.$L=r),n},v.clone=function(){return I.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},g}(),k=_.prototype;return R.prototype=k,[["$ms",r],["$s",i],["$m",o],["$H",s],["$W",a],["$M",l],["$y",d],["$D",f]].forEach((function(e){k[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),R.extend=function(e,t){return e.$i||(e(t,_,R),e.$i=!0),R},R.locale=S,R.isDayjs=O,R.unix=function(e){return R(1e3*e)},R.en=w[y],R.Ls=w,R.p={},R}()}));const Re="MIRROR_TRACK",Ie="log",_e="key",ke={createIndexedDB:()=>new Promise(((e,t)=>{const n=indexedDB.open(Re,1);n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(Ie)||t.createObjectStore(Ie,{keyPath:_e})},n.onsuccess=()=>{event.target.result.close(),e()},n.onerror=()=>{console.log("Indexed Start Error"),t()}})),add(e){const t=Se().format("YYYY-MM-DD-HH:mm:ss:SSS")+"_"+Math.ceil(999*Math.random())+"Z",n=indexedDB.open(Re,1);n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(Ie)||t.createObjectStore(Ie,{keyPath:_e})},n.onsuccess=n=>{const r=n.target.result;if(!r.objectStoreNames.contains(Ie))return;const i=r.transaction(Ie,"readwrite").objectStore(Ie),o=i.count();o.onsuccess=()=>{i.put({[_e]:`[${t}]-${e}`}),Number(o.result)<=1e5||(i.openCursor().onsuccess=e=>{const t=e.target.result;t&&t.delete()})},o.onerror=()=>{console.log("mirror indexDb count error")},r.close()},n.onerror=()=>{console.log("add Indexed Open Error")}},getAll:(e=!0)=>new Promise(((t,n)=>{let r=[];const i=indexedDB.open(Re);i.onsuccess=i=>{const o=i.target.result;if(!o.objectStoreNames.contains(Ie))return void n("the store log not exists in the MIRROR_TRACK databse");const s=o.transaction(Ie,"readonly").objectStore(Ie);if(e)s.openCursor().onsuccess=e=>{const n=e.target.result;if(n)r.push(n.key),r.push("\r\n"),n.continue();else{const e=new Blob(r,{type:"text/plain;charset=utf-8"});t(e)}},s.openCursor().onerror=()=>{n("OpenCursor Error")};else{s.getAll().onsuccess=function(e){const n=e.target.result;t(n)}}o.close()},i.onerror=()=>{n("Indexed Open Error")}})),clearStore(){const e=indexedDB.open(Re);e.onsuccess=e=>{const t=e.target.result;if(!t.objectStoreNames.contains(Ie))return void console.log(`Object store ${Ie} does not exist`);t.transaction(Ie,"readwrite").objectStore(Ie).clear().onsuccess=function(e){console.log("All entries have been removed from the store.")},t.close()},e.onerror=function(e){console.log("Error opening db",e.target.error)}},deleteIndexedDB(){const e=indexedDB.deleteDatabase(Re);e.onsuccess=()=>{console.log("Delete Success"),ke.createIndexedDB()},e.onerror=()=>{console.log("Delete Error")}}};var Ce,Te,Ne,Pe,$e,je,Ae;!function(e){e.INIT="init",e.ERROR="error",e.UNHANDLEDREJECTION="unhandledrejection",e.RESOURCE="resource",e.PERFORMANCE="performance",e.WHITESCREEN="whiteScreen",e.BREABCRUMB="breadcrumb"}(Ce||(Ce={})),function(e){e.ERROR="error",e.CLICK="click",e.HISTORY="history",e.HASHCHANGE="hashchange",e.UNHANDLEDREJECTION="unhandledrejection",e.RESOURCE="resource",e.WHITE="white",e.CUSTOM="custom",e.SCROLL="scroll",e.API="api"}(Te||(Te={})),function(e){e.BEFORE="mirrorHandlerBefore",e.AFTER="mirrorHandlerAfter"}(Ne||(Ne={})),function(e){e.ERROR="error",e.OK="ok"}(Pe||(Pe={})),function(e){e.AUTO="auto",e.DEFAULT="default"}($e||($e={})),function(e){e.HISTORY="history",e.HASH="hash",e.DOM="dom",e.JS="js",e.PROMISE="promise",e.RESOURCE="resource",e.WHITE="white",e.SCROLL="scroll",e.API="api"}(je||(je={})),function(e){e.LOAD="info-load",e.REFRESH="info-refresh",e.PAGETABSTATUS="info-visibilitychange",e.DEVICE="info-device",e.SCROLL="info-scroll",e.APISUCCESS="request-success",e.APIERROR="request-error",e.PAGECLOSE="info-close",e.CLICK="info-click",e.HISTORY="info-history",e.HASHCHANGE="info-hashchange",e.ERROR="error-js",e.UNHANDLEDREJECTION="error-unhandledrejection",e.RESOURCE="error-resource",e.WHITE="error-white"}(Ae||(Ae={}));const Me={isExclusive:1},Be={mirrorPolymer:3},De=(e,n="before",r)=>{const i=[];let o=!1,s=0;return{start(){return new Promise((a=>t(this,void 0,void 0,(function*(){if(!o){for(o=!0;s<e.length;){const t=e[s];if("before"===n?i.push(yield null==t?void 0:t.mirrorHandleBefore(r.type,r.data)):i.push(yield null==t?void 0:t.mirrorHandleAfter(r.type,r.data)),s++,!o)return}o=!1,a(i)}}))))}}};class Le{constructor(){this.timeID=null,this.func=null}repeat(e,t){null===this.func&&(this.func=e),this.func===e&&(this.timeID=setTimeout((()=>{e(),this.repeat(e,t)}),t))}clear(){clearTimeout(this.timeID)}}let He=null;class xe{before(e,n){return new Promise((r=>t(this,void 0,void 0,(function*(){if(M.plugins&&f.isArray(M.plugins))try{const t=M.plugins,i=yield De(t,"before",{type:e,data:n}).start();let[o]=i.slice(-1);r(o)}catch(e){console.warn("bili-mirror:plugin function before hook error,please check"),r(!0)}else if(M.plugins&&M.plugins.mirrorHandleBefore)try{M.plugins.mirrorHandleBefore(e,n).then((e=>{r(e)}))}catch(e){console.warn("bili-mirror:plugin function before hook error,please check"),r(!0)}else r(!0)}))))}after(e,n){return new Promise((r=>t(this,void 0,void 0,(function*(){if(M.plugins&&f.isArray(M.plugins))try{const t=M.plugins;yield De(t,"after",{type:e,data:n}).start(),r()}catch(e){console.warn("bili-mirror:plugin function after hook error,please check"),r()}else if(M.plugins&&M.plugins.mirrorHandleAfter)try{M.plugins.mirrorHandleAfter(e,n).then((()=>{r()}))}catch(e){console.warn("bili-mirror:plugin function after hook error,please check"),r()}else r()}))))}}He||(He=new xe);const Je=s();const Ue=r()?Je.breadcrumb||(Je.breadcrumb=new class{constructor(){this.maxBreadcrumbs=10,this.stack=[],this.isSet=!1}push(e){return t(this,void 0,void 0,(function*(){(null==M?void 0:M.config["user-log-deep"])&&!this.isSet&&(this.maxBreadcrumbs=null==M?void 0:M.config["user-log-deep"],this.isSet=!0);(yield He.before(Ce.BREABCRUMB,e))&&(this.immediatePush(e),c(o,"beforeunload",(()=>{this.stack.filter((e=>"error"===e.status)).length&&(this.goToReport(this.stack),window.__biliMirrorPbInstance__&&window.__biliMirrorPbInstance__.flush&&window.__biliMirrorPbInstance__.flush())})))}))}immediatePush(e){if(e.time||(e.time=l()),this.stack.length>=this.maxBreadcrumbs){this.stack.filter((e=>"error"===e.status)).length?(this.goToReport(this.stack),this.clear()):this.clear()}this.stack.push(e),this.stack.sort(((e,t)=>e.time-t.time))}shift(){return void 0!==this.stack.shift()}clear(){this.stack=[]}getStack(){return this.stack}goToReport(e){let t={};e.forEach(((e,n)=>{t[`logStep-${n}`]=e})),zt({type:"custom",event:`${M.origin}.${M.module}.USERLOG`,msg:Object.assign({userLogInfo:Object.assign({},t)},Me)}),He.after(Ce.BREABCRUMB,this.stack),this.clear()}}):null;let Fe=null;const We=s();function Ke(e){const t=(null==M?void 0:M.config["user-log"])||null;return!!t&&t.find((t=>t===e))}function Ye(){return"log"!==(null==We?void 0:We.logType)}class Ge{constructor(){}handleHistory(e){const{from:t,to:n}=e,{relative:r}=b(t),{relative:i}=b(n);Ye()&&et(Ae.HISTORY,"history跳转",{from:r||"/",to:i||"/"}),Ke(je.HISTORY)&&Ue.push({category:Te.HISTORY,status:Pe.OK,time:l(),msg:{from:r||"/",to:i||"/"}})}handleHashChange(e){const{oldURL:t,newURL:n}=e,{relative:r}=b(t),{relative:i}=b(n);Ye()&&et(Ae.HASHCHANGE,"hashChange跳转",{from:r,to:i}),Ke(je.HASH)&&Ue.push({category:Te.HASHCHANGE,status:Pe.OK,time:l(),msg:{from:r,to:i}})}handleDomClick(e){const t=function(e){if(e.target.offsetParent){const t=e.target.offsetParent.tagName.toLowerCase();return"body"===t||"html"===t||void 0===t?"":e.target.outerHTML}return e.target.outerHTML}(e);t&&(Ye()&&et(Ae.CLICK,"点击",{dom:t}),Ke(je.DOM)&&Ue.push({category:Te.CLICK,status:Pe.OK,time:l(),msg:{clickDom:t}}))}handleScroll(){const e=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;Ye()&&et(Ae.SCROLL,"页面滚动",{top:e}),Ke(je.SCROLL)&&Ue.push({category:Te.SCROLL,status:Pe.OK,time:l(),msg:{top:e}})}handleJsError(e){Ye()&&et(Ae.ERROR,"js报错",{message:e.message}),Ke(je.JS)&&Ue.push({category:Te.ERROR,status:Pe.ERROR,time:e.time||l(),msg:{message:e.message}})}handlePromiseError(e){Ye()&&et(Ae.UNHANDLEDREJECTION,"rejection错误",{message:e.message}),Ke(je.PROMISE)&&Ue.push({category:Te.UNHANDLEDREJECTION,status:Pe.ERROR,time:e.time||l(),msg:{message:e.message}})}handleResourceError(e){Ye()&&et(Ae.RESOURCE,"resource错误",{message:e.message,name:null==e?void 0:e.name}),Ke(je.RESOURCE)&&Ue.push({category:Te.RESOURCE,status:Pe.ERROR,time:e.time||l(),msg:{message:e.message,name:null==e?void 0:e.name}})}handleWhiteScreen(){Ye()&&et(Ae.WHITE,"白屏错误",{url:location.href}),Ke(je.WHITE)&&Ue.push({category:Te.WHITE,status:Pe.ERROR,time:l(),msg:{url:location.href}})}handleRequest(e){Ye()&&et(Ve(e.httpCode)?Ae.APISUCCESS:Ae.APIERROR,`请求httpCode:${e.httpCode}`,{api:e.api,traceId:e.traceId,code:e.code,messgae:e.msg}),Ke(je.API)&&Ue.push({category:Te.API,status:Ve(e.httpCode)?Pe.OK:Pe.ERROR,time:l(),msg:{api:e.api,traceId:e.traceId,code:e.code,messgae:e.msg}})}}function Ve(e){return e>=200&&e<300}Fe||(Fe=new Ge);let qe=v();const Xe={historyReplace(){if(!function(){const e=o.chrome,t=e&&e.app&&e.app.runtime,n="history"in o&&!!o.history.pushState&&!!o.history.replaceState;return!t&&n}())return;const e=o.onpopstate;function t(e){return function(...t){const n=t.length>2?t[2]:void 0;if(n){const e=qe,t=String(n);qe=t,Fe.handleHistory({from:e,to:t})}return e.apply(this,t)}}o.onpopstate=function(...t){const n=v(),r=qe;qe=n,Fe.handleHistory({from:r,to:n}),e&&e.apply(this,t)},y(o.history,"pushState",t),y(o.history,"replaceState",t)},hashChangeeReplace(){var e,t;e=o,t="onhashchange",Object.prototype.hasOwnProperty.call(e,t)&&c(o,"hashchange",(function(e){Fe.handleHashChange(e)}))},domClickReplace(){if(!("document"in o))return;const e=w(Fe.handleDomClick,300);c(o.document,"click",(function(t){e(t)}),!0)},scrollReplace(){const e=E(Fe.handleScroll,1e3);c(o,"scroll",(function(t){e(t)}),!0)},jsErrorReplace(e){null==Fe||Fe.handleJsError(e)},promiseErrorReplace(e){null==Fe||Fe.handlePromiseError(e)},resourceErrorReplace(e){null==Fe||Fe.handleResourceError(e)},whiteErrorReplace(){null==Fe||Fe.handleWhiteScreen()},apiReplace(e){null==Fe||Fe.handleRequest(e)}},Qe=s();function ze(e){const t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?decodeURIComponent(t[2]):null}function Ze(){const e=function(){const e=null==M?void 0:M.config.track,t=ze("buvid3"),n=ze("DedeUserID");return!(!e||0===Object.keys(e).length||!(null==e?void 0:e.mid.includes("*"))&&!(null==e?void 0:e.buvid.includes("*"))&&!(null==e?void 0:e.mid.includes(n))&&!(null==e?void 0:e.buvid.includes(t)))}(),t=function(){var e;return null===(e=null==M?void 0:M.config["user-log"])||void 0===e?void 0:e.length}();return e&&t?"all":e&&!t?"track":!e&&t?"log":"none"}function et(e,t,n){let r=`[${e}]: ${t} ${"string"==typeof n?n:JSON.stringify(n||"")}`;ke.add(r)}function tt(e){return new Promise(((n,r)=>t(this,void 0,void 0,(function*(){const t=new FormData;t.append("log",e),t.append("project",function(){const{spmId:e,origin:t,module:n}=Qe.options;return`${e||a}.${t}.${n}`}());try{const e=yield fetch("https://api.bilibili.com/x/web-frontend/action-log/upload",{method:"POST",body:t,credentials:"include"});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const r=yield e.json();n(r)}catch(e){r("Failed to upload log: "+e)}}))))}function nt(){return t(this,void 0,void 0,(function*(){r()&&(Qe.logType=Ze(),"none"!==Ze()&&("log"!==Qe.logType&&(yield ke.createIndexedDB(),function(){let e=performance.getEntriesByType("navigation");if(e.length>0)if("reload"===e[0].type)et(Ae.REFRESH,"页面刷新",{url:location.href});else{et(Ae.LOAD,"页面载入",{url:location.href});const e=window.innerWidth,t=window.innerHeight;et(Ae.DEVICE,"设备信息",{ua:navigator.userAgent,window_size:`${e}*${t}`})}o.addEventListener("visibilitychange",(()=>{"visible"===document.visibilityState?et(Ae.PAGETABSTATUS,"选项卡被激活"):"hidden"===document.visibilityState&&et(Ae.PAGETABSTATUS,"选项卡被隐藏")})),o.addEventListener("beforeunload",(()=>{et(Ae.PAGECLOSE,"页面关闭")}))}()),Xe.historyReplace(),Xe.hashChangeeReplace(),Xe.domClickReplace(),Xe.scrollReplace()))}))}let rt=null,it=null,ot=6e4*((null==M?void 0:M.config["poll-time"])||5);const st="BILI_MIRROR_REPORT_POOL";(null==M?void 0:M.config["poll-time"])||setTimeout((()=>{ot=6e4*((null==M?void 0:M.config["poll-time"])||5)}),1e3);const at=()=>{try{let e=JSON.parse(localStorage.getItem(st)||"{}");if(!Object.keys(e).length)return;Object.entries(e).forEach((([e,t])=>{rt.tech(e,t)})),localStorage.setItem(st,"{}")}catch(e){}},ct=()=>{it||(it=new Le,it.repeat(at,ot),c(o,"beforeunload",(function(){at(),lt()})))},lt=()=>{rt&&rt.flush&&rt.flush(),it&&it.clear()},ut="_BiliGreyResult",dt=()=>{const e=ft("offline-version"),t=ft("offline-name"),n=ft("offline-plat");return e?{offlineVersion:e,offlineName:t,offlinePlat:n}:{}},ft=e=>{var t;return(null===(t=document.getElementsByTagName("meta")[e])||void 0===t?void 0:t.content)||void 0};
/*!
     * @bilibili/js-bridge (v1.6.0)
     * 哔哩哔哩webview容器内H5页面与APP客户端交互JSB接入包
     */
function pt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function mt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pt(Object(n),!0).forEach((function(t){gt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ht(e){return(ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vt(e){return function(e){if(Array.isArray(e))return bt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return bt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?bt(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var yt,wt,Et="object"===("undefined"==typeof window?"undefined":ht(window)),Ot=Et?window:null;Ot&&(Ot.selfBrowser||(Ot.selfBrowser={version:(wt=navigator.userAgent,{mobile:/AppleWebKit.*Mobile.*/i.test(wt),ios:/\(i[^;]+;( U;)? CPU.+Mac OS X/i.test(wt),android:/Android/i.test(wt)||/Linux/i.test(wt),windowsphone:/Windows Phone/i.test(wt),iPhone:/iPhone/i.test(wt),iPad:/iPad/i.test(wt),webApp:!/Safari/i.test(wt),MicroMessenger:/MicroMessenger/i.test(wt),weibo:/Weibo/i.test(wt),uc:/UCBrowser/i.test(wt),qq:/MQQBrowser/i.test(wt),baidu:/Baidu/i.test(wt),mqq:/QQ\/([\d.]+)/i.test(wt),mbaidu:/baiduboxapp/i.test(wt),iqiyi:/iqiyi/i.test(wt),QQLive:/QQLive/i.test(wt),Safari:(yt=navigator.userAgent,!(!/ OS \d/.test(yt)||~yt.indexOf("CriOS")||yt.indexOf("Mozilla")||!/Safari\/[\d.]+$/.test(yt))),Youku:/youku/i.test(wt),chrome:/CriOS/i.test(wt),CMDC:/CMDC/i.test(wt),BiliApp:/BiliApp|BiliComic|hikari/i.test(wt),BiliMallSDK:/mallSdkVersion/i.test(wt),BiliHikari:/hikari/i.test(wt),bStar:/bstar_/i.test(wt)}),language:(navigator.browserLanguage||navigator.language).toLowerCase()}),Ot.BiliJsBridge||(Ot.BiliJsBridge={sendTasks:[],callbacks:[],biliInject:null,selfCallbackId:1,inited:!1,newVersion:!1}));var St=Et?navigator.userAgent:null,Rt=!!Et&&/BiliApp|BiliComic|hikari/i.test(St),It=[];function _t(e){var t;Ot.BiliJsBridge.biliInject.biliCallbackReceived||(Ot.BiliJsBridge.biliInject.biliCallbackReceived=function(e,t,n){var r=Ot.BiliJsBridge.callbacks.map((function(e){return e.callbackId})).indexOf(Number(e));if(r>=0){var i=Ot.BiliJsBridge.callbacks[r];if("global.import"===i.method&&(It=[]),"function"==typeof i.callback&&(i.callback(n||t),i.messageWindow)){var o=n;n instanceof Error&&(o={message:n.message,stack:n.stack});var s=JSON.stringify({jsbReceiveId:i.callbackId,jsbReceiveArgs:o||t});i.messageWindow.postMessage(s,"*")}}});var n,r=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&"function"==typeof e[i]&&"callback"!==i&&(r.push({callback:e[i],callbackId:Ot.BiliJsBridge.selfCallbackId,callbackName:i,messageWindow:e.messageWindow}),e[i]="",e.data[i+"CallbackId"]=Ot.BiliJsBridge.selfCallbackId++);if(r.push({method:e.method,callback:e.callback,callbackId:Ot.BiliJsBridge.selfCallbackId,callbackName:"callback",messageWindow:e.messageWindow}),(t=Ot.BiliJsBridge.callbacks).push.apply(t,r),e.msgCallbackId&&e.messageWindow){var o=JSON.stringify({msgCallbackId:e.msgCallbackId,callbacks:r.map((function(e){return{callbackId:e.callbackId,callbackName:e.callbackName}}))});e.messageWindow.postMessage(o,"*")}n=Ot.BiliJsBridge.biliInject&&"function"==typeof Ot.BiliJsBridge.biliInject.postMessage?Ot.BiliJsBridge.biliInject.postMessage.bind(Ot.BiliJsBridge.biliInject):function(){},Ot.selfBrowser.version.android?n(JSON.stringify({method:e.method,data:Object.assign(e.data,{callbackId:Ot.BiliJsBridge.selfCallbackId++})})):n({method:e.method,data:JSON.stringify(Object.assign(e.data,{callbackId:Ot.BiliJsBridge.selfCallbackId++}))})}function kt(e){if("global.import"===e.method&&(It=[]),(e=e||{}).data=e.data||{},!e.method)throw new Error("no method");Ot.BiliJsBridge.inited?Ot.BiliJsBridge.newVersion&&_t(e):Ot.BiliJsBridge.sendTasks.push(e)}function Ct(e){e&&e.method&&Tt(e.method).then((function(t){t&&kt(e)}))}function Tt(e){return new Promise((function(t,n){It.length?t(It.includes(e)):kt({method:"global.getAllSupport",callback:function(r){try{r&&r.length&&(It=r),t(r.includes(e))}catch(e){n(e)}}})}))}function Nt(){return Ot&&(Ot.biliInject||Ot.webkit&&Ot.webkit.messageHandlers&&Ot.webkit.messageHandlers.biliInject)}function Pt(){var e=[];[].forEach.call(arguments,(function(t){t instanceof Array?e=e.concat(t):"string"==typeof t&&e.push(t)})),Tt("global.import").then((function(t){t&&e.forEach((function(e){kt({method:"global.import",data:{namespace:e}})}))}))}var $t={},jt={};Et&&window.addEventListener("message",(function(e){if(e.data){var t={};try{t=JSON.parse(e.data)}catch(e){}if(t&&(t.msgCallbackId||t.jsbReceiveId)){var n=t.msgCallbackId,r=$t[n];if(r)return"function"==typeof r&&r(t),void delete $t[t.msgCallbackId];if(t.jsbReceiveId){var i=jt[t.jsbReceiveId];"function"==typeof i&&i(t.jsbReceiveArgs)}else{var o=e.source,s=t.method,a=t.option||{};switch(s){case"isSupport":return void Tt(t.api).then((function(e){o.postMessage(JSON.stringify(mt(mt({},t),{},{support:e})),"*")})).catch((function(){o.postMessage(JSON.stringify(mt(mt({},t),{},{support:!1})),"*")}));case"callNative":case"callNativeSafe":for(var c in a)"jsbCallbackFn"===a[c]&&(a[c]=function(){});return a.messageWindow=o,a.msgCallbackId=n,void("callNative"===s?kt(a):Ct(a));case"importNameSpace":Pt.apply(void 0,vt(t.namespaces)),o.postMessage(JSON.stringify(t),"*")}}}}}));var At=function(){return new Promise((function(e,t){if(Nt())t();else if(Ot.selfBrowser.version.ios)var n=setInterval((function(){Nt()&&(t(),clearInterval(n))}),1e3);else setTimeout((function(){Nt()&&t()}),2e3)})).catch((function(){Ot.BiliJsBridge.biliInject=Nt(),Ot.BiliJsBridge.newVersion=!0,Ot.BiliJsBridge.inited=!0,Ot.BiliJsBridge.sendTasks.forEach((function(e){return _t(e)})),Ot.BiliJsBridge.sendTasks=[]}))},Mt=Tt,Bt=kt,Dt=Ct,Lt=Pt;if(Et&&window!==window.parent&&window.top){var Ht=function(e,t){e.msgCallbackId=Math.random(),$t[e.msgCallbackId]=t||function(){},window.top.postMessage(JSON.stringify(e),"*")};At=function(){},Mt=function(e){return new Promise((function(t,n){Ht({method:"isSupport",api:e},(function(e){var n=e.support;return t(n)}))}))};var xt=function(e,t){var n=mt({},t);for(var r in n)"function"==typeof n[r]&&(n[r]="jsbCallbackFn");Ht({method:e,option:n},(function(e){(e.callbacks||[]).forEach((function(e){jt[e.callbackId]=t[e.callbackName]}))}))};Bt=function(e){return xt("callNative",e)},Dt=function(e){return xt("callNativeSafe",e)},Lt=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Ht({method:"importNameSpace",namespaces:t})}}var Jt={inBiliApp:Rt,initEnv:At,isSupport:Mt,callNative:Bt,callNativeSafe:Dt,importNameSpace:Lt,isNewJsBridge:Nt};const Ut=(()=>{if(!r())return{};if(!o[ut])return{};const e=o[ut];var t={};Object.entries(e).forEach((([e,n])=>{t[`${ut}_${e}`]=n}));const n=dt();return Object.assign(Object.assign({},t),n)})(),Ft=[];let Wt=!1,Kt="",Yt=null;const Gt=e=>{let t="";return t=e.diyevent?e.eventId||e.event:e.otherSpmId?`${e.otherSpmId}.${e.eventId}`:(null==M?void 0:M.spmId)?`${null==M?void 0:M.spmId}.${e.eventId}`:`${a}.${e.eventId}`,t};function Vt(){if(Ft.length&&!Wt){Wt=!0;const[e,t,n,r]=Ft.shift();if("middleWare"===t){if(Yt)return Wt=!1,Zt(n,r),void Vt();e(!0).then((e=>{var t;Wt=!1,Yt=e,rt!==(t=Yt)&&(rt=t),en(n,r),Vt()}))}else e().then((()=>{Wt=!1,t&&n&&t(n,r||void 0),Vt()}))}}const qt=e=>{const t=Kt?window[Kt]:window.__biliMirrorPbInstance__;e=rn(e);const n=Gt(e);t[e.type](n,e.msg)},Xt=(e,t)=>{t&&Object.keys(t).length>0&&tn(t),e=rn(e);const n=Gt(e),r=Kt?window[Kt]:window.__biliMirrorPbInstance__,i=Object.assign(Object.assign(Object.assign({},e.msg),Ut),{mirrorVersion:R,type:e.type||"custom"});r.tech(n,i)},Qt=e=>{Ft.push([nn,qt,e]),Vt()},zt=(e,t)=>{Ft.push([nn,Xt,e,t]),Vt()},Zt=(e,t)=>{var n;n=e.msg,"none"!==Ze()&&Xe.apiReplace(n),!e.msg.message&&e.msg.msg&&(e.msg.message=e.msg.msg),Yt?en(e,t):(Ft.push([nn,"middleWare",e,t]),Vt())},en=(e,t)=>{t&&void 0!==(null==t?void 0:t.isBatch)||(t=Object.assign(t||{},{isBatch:!1}));const n=((null==t?void 0:t.spmId)||a)+"."+((null==t?void 0:t.origin)||(null==M?void 0:M.origin))+"."+((null==t?void 0:t.module)||(null==M?void 0:M.module));(null==t?void 0:t.isBatch)?((e,t,n)=>{var r;const i=(null===(r=null==t?void 0:t.api)||void 0===r?void 0:r.split("?")[0])||"";try{let t=JSON.parse(localStorage.getItem(st)||"{}");t[e]||(t[e]=Object.assign(Object.assign({},n),Be)),t[e][i]?t[e][i]++:t[e][i]=1,localStorage.setItem(st,JSON.stringify(t))}catch(e){}ct()})(n+(t.eventId||".DATA.successReport"),e.msg,Object.assign({type:"custom",mirrorVersion:R},Ut)):Yt.tech(n+(t.eventId||".ERROR.errorReport"),Object.assign(Object.assign({type:e.type||"custom",mirrorVersion:R},e.msg),Ut))},tn=(e={feature:{tech:!0}})=>{window.__biliMirrorPbInstance__.options=Object.assign({feature:{tech:!0}},e)},nn=(e=!1)=>{try{return new Promise(((t,n)=>{if(r()||n("not support in server"),e){const e={feature:{tech:!0},autoPv:!1,batch:!1};if(window.ReporterPb){const n=new window.ReporterPb(Object.assign({},e));t(n)}else N(Object.assign({},e)).then((e=>{t(e)}))}else{const e=(null==M?void 0:M.pbOtherNameIns)?null==M?void 0:M.pbOtherNameIns:"";if(f.isObject(window[e])&&Object.keys(window[e]).length)Kt=e,console.warn(`Is using ${e} to report,Please confirm open [tech] config`),t();else if(window.__biliMirrorPbInstance__)t();else{const e=S({feature:{tech:!0}},(null==M?void 0:M.pbOptions)||{});window.ReporterPb?(window.__biliMirrorPbInstance__=new window.ReporterPb(e),t()):N(Object.assign({},e)).then((e=>{window.__biliMirrorPbInstance__=e,t()}))}}}))}catch(e){console.error("bili-mirror:load pb-report-Error load failed:",e)}};function rn(e){e.event&&!e.eventId&&(e.eventId=e.event);return e.eventId.split(".").length<=1&&(e.eventId=`${null==M?void 0:M.origin}.${null==M?void 0:M.module}.${e.eventId}`),"appear"===e.type&&(e.type="exposure"),e}var on=Oe((function(e,t){e.exports=function(){function e(e){return!isNaN(parseFloat(e))&&isFinite(e)}function t(e){return e.charAt(0).toUpperCase()+e.substring(1)}function n(e){return function(){return this[e]}}var r=["isConstructor","isEval","isNative","isToplevel"],i=["columnNumber","lineNumber"],o=["fileName","functionName","source"],s=["args"],a=["evalOrigin"],c=r.concat(i,o,s,a);function l(e){if(e)for(var n=0;n<c.length;n++)void 0!==e[c[n]]&&this["set"+t(c[n])](e[c[n]])}l.prototype={getArgs:function(){return this.args},setArgs:function(e){if("[object Array]"!==Object.prototype.toString.call(e))throw new TypeError("Args must be an Array");this.args=e},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(e){if(e instanceof l)this.evalOrigin=e;else{if(!(e instanceof Object))throw new TypeError("Eval Origin must be an Object or StackFrame");this.evalOrigin=new l(e)}},toString:function(){var e=this.getFileName()||"",t=this.getLineNumber()||"",n=this.getColumnNumber()||"",r=this.getFunctionName()||"";return this.getIsEval()?e?"[eval] ("+e+":"+t+":"+n+")":"[eval]:"+t+":"+n:r?r+" ("+e+":"+t+":"+n+")":e+":"+t+":"+n}},l.fromString=function(e){var t=e.indexOf("("),n=e.lastIndexOf(")"),r=e.substring(0,t),i=e.substring(t+1,n).split(","),o=e.substring(n+1);if(0===o.indexOf("@"))var s=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(o,""),a=s[1],c=s[2],u=s[3];return new l({functionName:r,args:i||void 0,fileName:a,lineNumber:c||void 0,columnNumber:u||void 0})};for(var u=0;u<r.length;u++)l.prototype["get"+t(r[u])]=n(r[u]),l.prototype["set"+t(r[u])]=function(e){return function(t){this[e]=Boolean(t)}}(r[u]);for(var d=0;d<i.length;d++)l.prototype["get"+t(i[d])]=n(i[d]),l.prototype["set"+t(i[d])]=function(t){return function(n){if(!e(n))throw new TypeError(t+" must be a Number");this[t]=Number(n)}}(i[d]);for(var f=0;f<o.length;f++)l.prototype["get"+t(o[f])]=n(o[f]),l.prototype["set"+t(o[f])]=function(e){return function(t){this[e]=String(t)}}(o[f]);return l}()})),sn=Oe((function(e,t){var n,r,i,o;e.exports=(n=on,r=/(^|@)\S+:\d+/,i=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/,{parse:function(e){if(void 0!==e.stacktrace||void 0!==e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(i))return this.parseV8OrIE(e);if(e.stack)return this.parseFFOrSafari(e);throw new Error("Cannot parse given Error object")},extractLocation:function(e){if(-1===e.indexOf(":"))return[e];var t=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(e.replace(/[()]/g,""));return[t[1],t[2]||void 0,t[3]||void 0]},parseV8OrIE:function(e){return e.stack.split("\n").filter((function(e){return!!e.match(i)}),this).map((function(e){e.indexOf("(eval ")>-1&&(e=e.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var t=e.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),r=t.match(/ (\(.+\)$)/);t=r?t.replace(r[0],""):t;var i=this.extractLocation(r?r[1]:t),o=r&&t||void 0,s=["eval","<anonymous>"].indexOf(i[0])>-1?void 0:i[0];return new n({functionName:o,fileName:s,lineNumber:i[1],columnNumber:i[2],source:e})}),this)},parseFFOrSafari:function(e){return e.stack.split("\n").filter((function(e){return!e.match(o)}),this).map((function(e){if(e.indexOf(" > eval")>-1&&(e=e.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),-1===e.indexOf("@")&&-1===e.indexOf(":"))return new n({functionName:e});var t=/((.*".+"[^@]*)?[^@]*)(?:@)/,r=e.match(t),i=r&&r[1]?r[1]:void 0,o=this.extractLocation(e.replace(t,""));return new n({functionName:i,fileName:o[0],lineNumber:o[1],columnNumber:o[2],source:e})}),this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(e){for(var t=/Line (\d+).*script (?:in )?(\S+)/i,r=e.message.split("\n"),i=[],o=2,s=r.length;o<s;o+=2){var a=t.exec(r[o]);a&&i.push(new n({fileName:a[2],lineNumber:a[1],source:r[o]}))}return i},parseOpera10:function(e){for(var t=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=e.stacktrace.split("\n"),i=[],o=0,s=r.length;o<s;o+=2){var a=t.exec(r[o]);a&&i.push(new n({functionName:a[3]||void 0,fileName:a[2],lineNumber:a[1],source:r[o]}))}return i},parseOpera11:function(e){return e.stack.split("\n").filter((function(e){return!!e.match(r)&&!e.match(/^Error created at/)}),this).map((function(e){var t,r=e.split("@"),i=this.extractLocation(r.pop()),o=r.shift()||"",s=o.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;o.match(/\(([^)]*)\)/)&&(t=o.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var a=void 0===t||"[arguments not available]"===t?void 0:t.split(",");return new n({functionName:s,args:a,fileName:i[0],lineNumber:i[1],columnNumber:i[2],source:e})}),this)}})}));const an=e=>{const t=e.target;if(null==t?void 0:t.localName){const e=function(e){return{time:l(),message:e.src||e.href||"",name:e.localName}}(t);return Object.assign(Object.assign({},e),{type:"resourceError"})}return null},cn=[],ln=e=>{const t=(n=(null==e?void 0:e.message)||(null==e?void 0:e.fileName),window.btoa(decodeURIComponent(encodeURIComponent(n))));var n;return cn.some((e=>e===t))?(console.warn(`Duplicate error, not reported,${null==e?void 0:e.message}`),!1):(cn.push(t),!0)},un={handleError(e){var n,r,i,s;return t(this,void 0,void 0,(function*(){if((null==o?void 0:o.screen.width)<=100||o.screen.height<=100)return;if((null==o?void 0:o.innerWidth)<=100||o.innerHeight<=100)return;const t=e.target;try{if(!t||e.target&&!e.target.localName){const t=(e=>{var t;const n=e.target;if(!n||e.target&&!(null===(t=e.target)||void 0===t?void 0:t.localName)){let t=sn.parse(n?e.error:e).slice(0,5),r=[];t.forEach((e=>{let{source:t}=e;const n=t?t.split(" ").join("").split("./"):"";r.push(n)}));let i=sn.parse(n?e.error:e)[0],{fileName:o,columnNumber:s,lineNumber:a}=i;return{type:"error",time:l(),message:e.message,fileName:o,line:a,column:s,stack:JSON.stringify(r)}}return null})(e),i=null===(r=null===(n=null==M?void 0:M.config)||void 0===n?void 0:n.white)||void 0===r?void 0:r.error;if(!m(t,i)){if(!ln(t))return;if(!(yield He.before(Ce.ERROR,t)))return;zt({type:"error",eventId:`${M.origin}.${M.module}.ERROR.jsError`,msg:t},M.pbOptions||{}),Xe.jsErrorReplace(t),He.after(Ce.ERROR,t)}}if(null==t?void 0:t.localName){let t=an(e);const n=null===(s=null===(i=null==M?void 0:M.config)||void 0===i?void 0:i.white)||void 0===s?void 0:s.resource;if(!m(t,n)){if(!ln(t))return;if(!(yield He.before(Ce.RESOURCE,t)))return;zt({type:"error",eventId:`${M.origin}.${M.module}.ERROR.resourceError`,msg:Object.assign(Object.assign({},t),{error_type:"AssetsError",headless:""==navigator.language?"headless":"normal",webdriver:null===navigator||void 0===navigator?void 0:navigator.webdriver})},M.pbOptions||{}),Xe.resourceErrorReplace(t),He.after(Ce.RESOURCE,t)}}}catch(e){console.warn("bili-mirror: handleError-Error parsing failed:",e)}}))},handleUnhandleRejection(e){var n,r;return t(this,void 0,void 0,(function*(){try{if((null==o?void 0:o.screen.width)<=100||o.screen.height<=100)return;if((null==o?void 0:o.innerWidth)<=100||o.innerHeight<=100)return;const t=(e=>{let t=sn.parse(e.reason).slice(0,5),n=[];t.forEach((e=>{let{source:t}=e;const r=t?t.split(" ").join("").split("./"):"";n.push(r)}));let r=sn.parse(e.reason)[0],{fileName:i,columnNumber:o,lineNumber:s}=r;var a;return{type:"rejectionError",time:l(),message:(a=e.reason.message||e.reason.stack,f.isString(a)?a:f.isUndefined(a)?"undefined":JSON.stringify(a)),fileName:i,line:s,column:o,stack:JSON.stringify(n)}})(e),i=null===(r=null===(n=null==M?void 0:M.config)||void 0===n?void 0:n.white)||void 0===r?void 0:r.rejection;if(!m(t,i)){if(!ln(t))return;if(!(yield He.before(Ce.UNHANDLEDREJECTION,t)))return;zt({type:"error",eventId:`${M.origin}.${M.module}.ERROR.rejectionError`,msg:t},M.pbOptions||{}),Xe.promiseErrorReplace(t),He.after(Ce.UNHANDLEDREJECTION,t)}}catch(e){console.warn("bili-mirror: handleUnhandleRejection-Error parsing failed:",e)}}))},handlePerformance(){return t(this,void 0,void 0,(function*(){try{if(!PerformanceObserver||!(null===PerformanceObserver||void 0===PerformanceObserver?void 0:PerformanceObserver.supportedEntryTypes))return;if(g(M.config["white-preformance-rate"]))return;Ee((e=>t(this,void 0,void 0,(function*(){let{name:t,value:n}=e;if(!n||n<0)return;(yield He.before(Ce.PERFORMANCE,e))&&(zt({type:"performance",eventId:`${M.origin}.${M.module}.PERFORMANCE.${e.name}`,msg:"PAGETIME"===t?Object.assign({},null==e?void 0:e.data):Object.assign({},e)},M.pbOptions||{}),He.after(Ce.PERFORMANCE,e))}))))}catch(e){console.warn("bili-mirror: performance-Error parsing failed:",e)}}))}};var dn;!function(e){e.ERROR="error",e.OK="ok"}(dn||(dn={}));let fn=null,pn=null;const mn="BILI_MIRROR_RESOURCE_TIME",hn=["xmlhttprequest","fetch","img","image","link","css","video","iframe","script"],gn={API:"xmlhttprequest,fetch",IMG:"img,image",CSS:"link,css",JS:"script",VIDEO:"video",IFRAME:"iframe"};class vn{constructor(){this._cleanUpReportPool=()=>{fn&&fn.clear(),window.__biliMirrorPbInstance__&&window.__biliMirrorPbInstance__.flush&&window.__biliMirrorPbInstance__.flush()},this.config=M.config["resource-time"]||{},this.resourceWaitList=[],this.disablePush=!1}on(){PerformanceObserver&&(null===PerformanceObserver||void 0===PerformanceObserver?void 0:PerformanceObserver.supportedEntryTypes)&&(this._getAllData(),this._createObserver())}destroy(){pn&&pn.disconnect(),fn&&fn.clear()}_getAllData(){const e=performance.getEntriesByType("resource");(e||e.length)&&e.forEach((e=>{this.resourceWaitList.push(e)}))}_handlerResourceInit(){for(this.disablePush=!0;this.resourceWaitList.length;){let e=this.resourceWaitList.shift();if(!this._isCheckResource(e))continue;const t=this._computeResourceData_(e);this._addResourceReportPool(t)}this.disablePush=!1,this._startReportInterval()}_isCheckResource(e){if(!hn.includes(e.initiatorType))return!1;if(!Object.keys(this.config).length)return!1;let t=!1;for(let n in this.config){if(gn[n].split(",").includes(e.initiatorType)){if("*"===this.config[n]){t=!0;break}if(!this.config[n])continue;if(Array.isArray(this.config[n])&&this.config[n].length)for(let r=0;r<this.config[n].length;r++){if(e.name.split("?")[0].match(this.config[n][r])){t=!0;break}}}}return t}_computeResourceData_(e){const t=e.name.split("?"),{transferSize:n,initiatorType:r,duration:i,nextHopProtocol:o,redirectStart:s,redirectEnd:a,domainLookupEnd:c,domainLookupStart:l,connectEnd:u,connectStart:d,secureConnectionStart:f,responseStart:p,requestStart:m,responseEnd:h}=e;return{url:t[0],query:t[1],duration:i.toFixed(2),size:n,type:r,protocol:o,redirectTime:a-s,dnsTime:c-l,sslTime:u-f,tcpTime:u-d,requestTime:p-m,responseTime:h-p}}_addResourceReportPool(e){let t=JSON.parse(localStorage.getItem(mn)||"{}");const n=e.url;t[n]||(t[n]=Object.assign({},e)),localStorage.setItem(mn,JSON.stringify(t))}_startReportInterval(){fn||(fn=new Le,fn.repeat(this._clearResourceReport,18e4),c(o,"beforeunload",(()=>{this._clearResourceReport(),this._cleanUpReportPool()})))}_clearResourceReport(){try{let e=JSON.parse(localStorage.getItem(mn)||"{}");Object.keys(e).length&&zt({type:"performance",eventId:`${M.origin}.${M.module}.PERFORMANCE.RESOURCETIME`,msg:{resourceListInfo:Object.assign({},e)}}),localStorage.setItem(mn,"")}catch(e){}}_createObserver(){pn=new PerformanceObserver((e=>{e.getEntries().forEach((e=>{this.resourceWaitList.push(e.toJSON())})),this.disablePush||this._handlerResourceInit()})),pn.observe({entryTypes:["resource"]})}}function bn(e){if(r()){if(c(o,"error",(function(e){un.handleError(e)}),!0),c(o,"unhandledrejection",(function(e){un.handleUnhandleRejection(e)})),un.handlePerformance(),null==e?void 0:e.whiteScreen)try{!function(e){if((null==o?void 0:o.screen.width)<=10||o.screen.height<=10)return;if((null==o?void 0:o.innerWidth)<=10||o.innerHeight<=10)return;const n=e.checkNum||3,r=e.maxLoop||9,i=e.elemArry||e.checkDom||["html","body","#app"],a=e.callback||function(){},c=s();let l=0;const u=[];let d=[],f={};function p(e){return e.id?"#"+e.id:e.className&&"string"==typeof e.className?"."+e.className.split(" ").filter((e=>!!e)).join("."):e.nodeName.toLowerCase()}function m(t){const n=p(t);e.isSkeleton&&(l?d.push(n):u.push(n));let r=!1;if(!n||!i)return r;for(let e=0;e<=i.length;e++)if(i[e]&&n.match(i[e])){r=!0;break}return r}function h(){return t(this,void 0,void 0,(function*(){if(!document||!document.elementsFromPoint)return void console.warn("当前浏览器不支持elementsFromPoint方法,白屏检测跳过");if(!(yield He.before(Ce.WHITESCREEN)))return;f.check_list=i;let t=!0;for(let e=1;e<=7;e+=3){const r=o.innerWidth*e/10,i=o.innerHeight/2,s=o.innerWidth/2,a=o.innerHeight*e/10,c=document.elementsFromPoint(r,i),l=document.elementsFromPoint(s,a);if(c.length>n){const e=[];f[`pointX-${r}-${i}`]||(f[`pointX-${r}-${i}`]=[]);for(let n=0;n<c.length;n++)if(e.push(p(c[n])),m(c[n])){t=!1;break}f[`pointX-${r}-${i}`].length||(f[`pointX-${r}-${i}`]=e)}if(!t)break;if(t&&l.length>n&&5!=e){const e=[];f[`pointY-${s}-${a}`]||(f[`pointY-${s}-${a}`]=[]);for(let n=0;n<l.length;n++)if(e.push(p(l[n])),m(l[n])){t=!1;break}f[`pointY-${s}-${a}`].length||(f[`pointY-${s}-${a}`]=e)}if(!t)break}if(t)g();else{if(e.isSkeleton){if(!l)return g();if(d.join()==u.join())return a({status:dn.ERROR})}c._loopTimer&&clearTimeout(c._loopTimer),c._loopTimer=null}a({status:t?dn.ERROR:dn.OK,loop:l,data:Object.assign({},f)}),l>=r&&(zt({type:"error",eventId:`${M.origin}.${M.module}.ERROR.whiteScreen`,msg:{_BiliCheckDom_Point:Object.assign({},f)}}),Xe.whiteErrorReplace()),He.after(Ce.WHITESCREEN,Object.assign({},f))}))}function g(){l>=r&&c._loopTimer?(clearTimeout(c._loopTimer),c._loopTimer=null):c._loopTimer=setTimeout((()=>{l++,e.isSkeleton&&(d=[]),h()}),1e3)}e.isSkeleton?"complete"!=document.readyState&&h():"complete"===document.readyState?h():o.addEventListener("load",h)}(e.whiteScreen)}catch(e){console.error("bili-mirror: whiteScreen错误解析异常:",e)}M.config["resource-time"]&&Object.keys(M.config["resource-time"]).length&&c(o,"load",(function(){const e=new vn;try{e.on()}catch(t){e.destroy(),console.warn("bili-mirror:resource-watch error",t)}}))}}const yn=(e={})=>{const t=null==M?void 0:M.config["tech-pv"];if(!t)return;if(g(t))return;const n=`${M.origin}.${M.module}.TECHPV.0.0`;zt({eventId:n,type:"custom",msg:Object.assign(Object.assign({},e),Me)})};var wn;const En=s(),On=e=>{!function(e){const t=A();null==t||t.updateModule(e)}(e)},Sn=e=>{r()&&Qt(e)},Rn=e=>{return t=e,new Promise(((e,n)=>{Rt||n("not in bili app"),At();const r="ability.reportEventV3";Mt(r).then((i=>{i?Jt.callNative({method:r,data:{type:t.type,event:t.event,params:t.params,label:t.label},callback:()=>{e("success")}}):n("not support")})).catch((e=>{n(e)}))}));var t},In=e=>{r()&&zt(e)},_n=e=>{r()&&tn(e)},kn=(e,t)=>{r()&&Qt({type:"pv",eventId:"0.0",msg:e,otherSpmId:t||null})},Cn=e=>{r()&&p(e.key)&&zt({type:"custom",eventId:e.eventId,diyevent:!0,msg:Object.assign(Object.assign({exclusiveFrom:(null==e?void 0:e.key)||""},e.msg),Me)})},Tn=()=>new Promise(((e,t)=>{ke.getAll().then((n=>{tt(n).then((t=>{e(t)})).catch((e=>{t(e)}))})).catch((e=>{t(e)}))})),Nn=(e,t,n)=>{et(e,t,n)},Pn=()=>ke.getAll(!1);function $n(e){r()&&(En.isInited||(En.isInited=!0,En.mirrorInitMode||(En.mirrorInitMode=$e.DEFAULT),B(e).then((()=>t(this,void 0,void 0,(function*(){yield nn();(yield He.before(Ce.INIT,e))&&(bn(null==e?void 0:e.config),yn(),nt(),He.after(Ce.INIT,e),console.info("%c%s","line-height: 30px; color: #FF6699",`bili-fe-mirror:${_}`))})))).catch((e=>{console.warn(e)}))))}const jn=(e,t)=>{r()&&Zt(e,t)},An=e=>{if(!r())return;if(!p(e.name))return;const t=`${M.origin}.${M.module}.PERFORMANCE.${e.name}`;zt({type:"performance",eventId:t,msg:{name:e.name,value:e.value}})},Mn=(e={})=>{yn(e)};if(r()){window.__INITIAL_MIRROR__=$n,window.__MIRROR_REPORT__={techReportPb:In,customReportPb:Sn,pbReportPv:kn,changePbOptions:_n,canBatchTechReport:jn,customPerformanceQuota:An,exclusiveBisReport:Cn,changeMirrorModule:On,mirrorTechPvReport:Mn,customReportNative:Rn,trackLogReport:Tn,trackCustomLog:Nn,trackGetLog:Pn};const e=window.__MIRROR_CONFIG__,t=null===(wn=null==e?void 0:e.config)||void 0===wn?void 0:wn.isAutoInit;e&&f.isObject(e)&&t&&(!En.mirrorInitMode&&(En.mirrorInitMode=$e.AUTO),$n(e))}var Bn={SDK_NAME:I,SDK_VERSION:_,init:$n,install:function(e,t={}){let n=e.config.errorHandler;e.config.errorHandler=function(e,t,r){un.handleError(e),n&&n.apply(null,[e,t,r]),console.error(e)},$n(t)},errorBoundary:e=>{un.handleError(e)}};e.canBatchTechReport=jn,e.changeMirrorModule=On,e.changePbOptions=_n,e.customPerformanceQuota=An,e.customReport=Sn,e.customReportNative=Rn,e.customReportPb=Sn,e.default=Bn,e.exclusiveBisReport=Cn,e.mirrorTechPvReport=Mn,e.pbReportPv=kn,e.techReportPb=In,e.trackCustomLog=Nn,e.trackGetLog=Pn,e.trackLogReport=Tn,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=biliMirror.umd.mini.js.map
